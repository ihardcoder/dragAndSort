var dragmodule=function(i){var t={$container:null,$individualRows:null,$individualBanners:null,$subscribeBox:null,$inheritRows:null,$inheritBanners:null,$itemRows:null,$btnTotop:null,$moduleOnTop:null,$dragScar:null,$userSubscripe:null,individualSum:0,inheritSum:0,itemSum:0,$focusOrigin:null,$focusBannerOrigin:null,$vList:null,$vListBox:null,$vDragblank:null,$vListPrevBanner:null,$vListNextBanner:null,pressTimer:null,sortTimer:null,orderTimer:null,slideTime:400,aniTime:void 0,focusOrder:null,startIndex:null,endIndex:null,isFoused:!1,focusOrdinate:null,firstOffset:null,lastOffset:null,listOffset:null,boxOffset:null,topOffset:null,windowH:0,windowW:0,unitHeight:150,dragDest:0,scrollUpEdge:void 0,scrollDownEdge:void 0,scrollupable:!0,scrolldownable:!0,ClassRowIndex:"drawer drawer_subscribe dragmodule",ClassOnTop:"dragmodule-top",eTop:0,eBottom:0,listItemSize:{width:40,height:40,zoom:.5,marginBottem:10},focusItemSize:{width:80,height:80,zoom:1,marginBottem:10},callback:null,UA:null,init:function(t,e,s){var n=this;s&&"function"==typeof s&&(this.callback=s),this.unBind(),this.$userSubscripe=i(".yk-subscipe-user"),this.$container=i(".container"),this.$individualRows=i(".dragmodule[drag-mode=individual]:visible"),this.$individualBanners=this.$individualRows.find(".drag-banner"),this.individualSum=this.$individualRows.length,this.$subscribeBox=i(".dragmodule[drag-mode=container]"),this.$inheritRows=this.$subscribeBox.find(".dragmodule[drag-mode=inherit]:visible"),this.$inheritBanners=this.$inheritRows.find(".drag-banner"),this.inheritSum=this.$inheritRows.length,this.itemSum=this.individualSum+this.inheritSum,this.$itemRows=i(i.merge(i.merge([],this.$individualRows),this.$inheritRows)),this.$itemRows.each(function(t){i(this).attr("drag-order",t)}),this.$banners=i(i.merge(i.merge([],this.$individualBanners),this.$inheritBanners)),this.$dragScar=this.$itemRows.find(".drag-scar"),this.$btnTotop=this.$itemRows.find(".drag-totop"),i(this.$itemRows[0]).addClass(n.ClassOnTop),this.$moduleOnTop=i(this.$itemRows[0]),this.topOffset=this.$moduleOnTop.position(),this.windowW=i(window).width(),this.windowH=i(window).height(),this.UA=this.getUA(),this.UA.ie&&parseInt(n.UA.ie)<8&&(t=!1),t&&0!=this.$individualRows.length&&this.bind(e)},bind:function(t){var e=this;i(window).resize(function(){e.windowH=i(this).height(),e.windowW=i(this).width()}),t&&this.$btnTotop.on("click",function(t){var s=t||window.event;s.preventDefault&&(s.preventDefault(),s.stopPropagation()),e.toTop(i(this))}),this.$banners.on("mousedown",function(t){var s=t||window.event;s.preventDefault&&(s.preventDefault(),s.stopPropagation()),e.focusOrdinate={top:s.clientY,left:s.clientX},e.$focusOrigin=i(this).parents(".dragmodule[drag-mode!=container]"),"individual"===e.$focusOrigin.attr("drag-mode")&&e.$individualRows.length<=1||(e.$focusBannerOrigin=i(this),e.$focusBannerOrigin.addClass("dragging"),e.pressTimer&&clearTimeout(e.pressTimer),e.pressTimer=setTimeout(function(){e.isFoused=!0,e.generateList()},200))}).on("mouseup",function(i){var t=i||window.event;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),e.pressTimer&&clearTimeout(e.pressTimer)}),this.$dragScar.on("mousedown",function(t){var s=t||window.event;s.preventDefault&&(s.preventDefault(),s.stopPropagation()),e.focusOrdinate={top:s.clientY,left:s.clientX},e.$focusOrigin=i(this).parents(".dragmodule[drag-mode!=container]"),"individual"===e.$focusOrigin.attr("drag-mode")&&e.$individualRows.length<=1||(e.$focusBannerOrigin=e.$focusOrigin.find(".drag-banner"),e.$focusBannerOrigin.addClass("dragging"),e.pressTimer&&clearTimeout(e.pressTimer),e.pressTimer=setTimeout(function(){e.isFoused=!0,e.generateList()},100))}).on("mouseup",function(i){var t=i||window.event;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),e.pressTimer&&clearTimeout(e.pressTimer)}),this.$userSubscripe.on("mouseover",function(t){var e=t||window.event;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),i(this).addClass("yk-subscipe-user-hover")}).on("mouseleave",function(t){var e=t||window.event;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),i(this).removeClass("yk-subscipe-user-hover")})},generateList:function(){var t,e,s,n,o=this;this.$vList=i("<div class='yk-draglist' ></div>").appendTo(o.$container),this.$vListBox=i("<div class='box'></div>").appendTo(o.$vList),this.$vListUl=i("<ul class='list'></ul>").appendTo(o.$vListBox),this.$vList.on("selectstart",function(){return!1}),"inherit"!==this.$focusOrigin.attr("drag-mode")?this.$individualBanners.each(function(a){t=i(this).find(".drag-tag"),e=t.clone(),s=i("<span class='entry'></span>"),n=i("<li class='dragitem'></li>"),s.html(t.attr("drag-name")),i(this).hasClass("dragging")?(n.addClass("dragging"),e.css({zoom:o.focusItemSize.zoom,"-moz-transform":"scale("+o.focusItemSize.zoom+")","-moz-transform-origin":"top left",marginBottem:o.focusItemSize.marginBottem+"px"})):e.css({zoom:o.listItemSize.zoom,"-moz-transform":"scale("+o.listItemSize.zoom+")","-moz-transform-origin":"top left",marginBottem:o.listItemSize.marginBottem+"px"}),e.appendTo(n),s.appendTo(n),n.data("order",a).appendTo(o.$vListUl)}):(this.$individualBanners.each(function(a){t=i(this).find(".drag-tag"),e=t.clone().addClass("ico"),s=i("<span class='entry'></span>"),n=i("<li class='dragitem'></li>"),s.html(t.attr("drag-name")),e.css({zoom:o.listItemSize.zoom,"-moz-transform":"scale("+o.focusItemSize.zoom+")","-moz-transform-origin":"top left",marginBottem:o.listItemSize.marginBottem+"px"}),e.appendTo(n),s.appendTo(n),n.data("order",a).appendTo(o.$vListUl)}),t=this.$focusBannerOrigin.find("img"),e=t.clone().addClass("ico"),s=i("<span class='entry'></span>"),n=i("<li class='dragitem'></li>"),s.html(t.attr("alt")),n.addClass("dragging"),e.css({width:o.focusItemSize.width+"px",height:o.focusItemSize.height+"px",marginBottem:o.focusItemSize.marginBottem+"px"}),e.appendTo(n),s.appendTo(n),n.data("order",o.individualSum).appendTo(o.$vListUl)),this.$vDragblank=i("<li></li>").addClass("dragitem dragitem-blank").appendTo(o.$vListUl),this.$vListPrevBanner=i("<div class='dragbanner dragbanner-prev'><span class='banner banner-prev'></span></div>").appendTo(o.$vListBox),this.$vListNextBanner=i("<div class='dragbanner dragbanner-next'><span class='banner banner-next'></span></div>").appendTo(o.$vListBox),this.formatList()},formatList:function(){var t=this,e=this.$vList.find(".dragging"),s=this.$vList.find(".dragitem").not(".dragging").not(".dragitem-blank"),n=this.listItemSize.height,o=(this.listItemSize.width,this.listItemSize.marginBottem),a=this.focusItemSize.height,r=this.focusItemSize.width,d=this.focusItemSize.marginBottem,l=(this.listItemSize.width/2,this.focusOrdinate.top-a/2),h=(this.focusOrdinate.left-r/2,s.length);this.focusOrder=e.data("order"),this.startIndex=this.focusOrder,this.$vList.show().css({opacity:0}),e.css({position:"absolute",top:l+"px",left:0}).removeClass("dragitem").removeData("order"),s.each(function(e){var s=i(this).data("order"),r=void 0;r=s>t.focusOrder?l+a+(n+o)*(s-1-t.focusOrder):l-(n+o)*(t.focusOrder-s),i(this).css({position:"absolute",top:r+"px",left:0}),0===e&&(t.firstOffset={top:r,left:0},s>t.focusOrder&&(t.firstOffset={top:r-a-d,left:0}),0>r&&t.$vListPrevBanner.show()),e===h-1&&(t.lastOffset={top:r,left:0},r+t.listItemSize.height-t.windowH>0&&t.$vListNextBanner.show())}),this.$vDragblank.css({width:t.focusItemSize.width+"px",height:t.focusItemSize.height+"px",marginBottem:t.focusItemSize.marginBottem+"px",position:"absolute",top:l+"px",left:0}).data("order",t.focusOrder).insertBefore(e).show(),this.showList(),this.listOffset=this.$vListUl.offset(),this.setScrollEdge(),i(document).on("mousemove",function(i){var s=i||window.event;s.preventDefault&&(s.preventDefault(),s.stopPropagation());var n={top:s.clientY,left:s.clientX};t.eTop=n.top-t.focusItemSize.height/2,t.eBottom=n.top+t.focusItemSize.height/2,e.css({position:"fixed",top:t.eTop+"px",left:t.listOffset.left+"px"}),clearTimeout(t.orderTimer),t.orderTimer=setTimeout(function(){t.order()},0)}).on("mouseup",function(){i(t.$banners).unbind("mousemove"),t.endIndex=t.$vDragblank.data("order"),t.dragDest=parseInt(t.endIndex),t.endIndex!==t.startIndex&&(0===t.endIndex?t.sortOrigin(t.$focusOrigin[0],t.$itemRows[0],0,!1):t.endIndex===t.itemSum?t.sortOrigin(t.$focusOrigin[0],t.$itemRows[t.itemSum-1],1,!1):(t.startIndex>t.endIndex?(t.endIndex--,t.sortOrigin(t.$focusOrigin[0],t.$itemRows.parent().find("[drag-order="+t.endIndex+"]")[0],1,!1)):t.sortOrigin(t.$focusOrigin[0],t.$itemRows.parent().find("[drag-order="+t.endIndex+"]")[0],1,!0),t.$focusOrigin.hasClass("drawer_subscribe")&&t.$focusOrigin.removeClass("yk-row yk-row-b30").attr("drag-mode","individual"))),t.$vDragblank.removeData("order").hide(),setTimeout(function(){t.hideList(),t.init(!0),t.$banners.removeClass("dragging"),i(document).unbind("mousemove mouseup")},100)})},order:function(){var t,e=this,s=this.$vList.find(".dragging"),n=this.$vList.find(".dragitem").not(".dragging"),o=this.listItemSize.height,a=(this.listItemSize.width,this.listItemSize.marginBottem,this.focusItemSize.height),r=(this.focusItemSize.width,this.focusItemSize.marginBottem,0),d=0,l=n.length;n.each(function(n){r=s.offset().top,d=i(this).offset().top,t=i(this).data("order"),e.focusOrder>t&&d+o/2>r+a/2?(e.focusOrder=t,e.$vDragblank.insertBefore(i(this))):e.focusOrder<t&&r+a/2>d+o/2&&(e.focusOrder=t,e.$vDragblank.insertAfter(i(this))),n===l-1&&e.formatOrder()})},formatOrder:function(){var t=this,e=this.$vList.find(".dragitem").not(".dragging"),s=e.length;e.each(function(e){i(this).data("order",e),e==s-1&&t.sort()})},sort:function(){var t=this,e=this.$vList.find(".dragitem"),s=this.listItemSize.height,n=this.listItemSize.marginBottem,o=this.focusItemSize.height,a=this.focusItemSize.marginBottem,r=e.length;e.each(function(e){var d=i(this).data("order");i(this).css(d<=t.focusOrder?{position:"absolute",top:(s+n)*i(this).data("order")+t.firstOffset.top+"px"}:{position:"absolute",top:(s+n)*(d-1)+o+a+t.firstOffset.top+"px"}),e===r-1&&setTimeout(function(){t.scrollList()},0)})},scrollList:function(){var i=this,t=this.$vListUl.position().top,e=this.$vListUl.find(".dragitem").not(".dragitem-blank"),s=e[0],n=e[e.length-1];s.getBoundingClientRect().top<0&&this.$vListPrevBanner.show(),this.windowH-n.getBoundingClientRect().top-this.listItemSize.height<0&&this.$vListNextBanner.show(),this.scrolldownable&&this.eTop<70&&i.$vDragblank.data("order")>=2&&t<this.scrollDownEdge?(this.$vListUl.css({top:"+="+(i.focusItemSize.height+i.focusItemSize.marginBottem)+"px"}),t=this.$vListUl.position().top):this.scrollupable&&this.eBottom>i.windowH-70&&i.$vDragblank.data("order")<=i.itemSum-3&&t>this.scrollUpEdge&&(i.$vListUl.css({top:"-="+(i.focusItemSize.height+i.focusItemSize.marginBottem)+"px"}),t=i.$vListUl.position().top)},sortOrigin:function(t,e,s,n){var o=this;if(t!=e){var a,r,d=i(t),l=i(e),h=d.height(),m=d.width(),u=parseInt(d.css("margin-bottom").split("px")[0]),c=d.position(),p=l.position().top;1===s&&(0!=l.next(".dragmodule:visible").length?p=l.next(".dragmodule:visible").position().top:(a=l.height(),r=parseInt(l.css("margin-bottom").split("px")[0]),p=p+a+r)),n&&(p-=h+u),this.$container.css("position","relative");var g=d.clone().css({position:"absolute",top:c.top+"px",width:m+"px",height:h+"px",zIndex:200,display:"none"}).appendTo(o.$container),f=i("<div></div>");switch(this.aniTime=this.slideTime*Math.round(Math.abs(c.top-p)/o.unitHeight),this.aniTime>800&&(this.aniTime=800),"inherit"===d.attr("drag-mode")&&d.attr({"drag-mode":"individual","class":o.ClassRowIndex}),f.css({height:h+u+"px",marginBottom:0,width:m+"px",overflow:"hidden",visibility:"hidden",opacity:0}).insertBefore(d),s){case 0:d.css({height:0,marginBottom:0,opacity:0}).insertBefore(l);break;case 1:d.css({height:0,marginBottom:0,opacity:0}).insertAfter(l)}f.animate({height:0},o.slideTime,function(){i(this).remove()}),d.animate({height:h+u+"px",opacity:1},o.slideTime,function(){i(this).css({height:h+"px",marginBottom:u+"px"})}),g.css({display:"block",opacity:1}).animate({opacity:.1,top:p+"px"},o.aniTime,function(){i(this).remove(),o.excuteCallback(),o.init(!0),o.getOnTop()})}},setScrollEdge:function(){var i=this.firstOffset.top,t=this.lastOffset.top+this.listItemSize.height-this.windowH;this.blankArea=this.focusItemSize.height+this.focusItemSize.marginBottem,0>=i?this.scrollDownEdge=Math.abs(i)+this.blankArea:i>0&&(this.scrollDownEdge=this.blankArea-i>0?this.blankArea-i:0),t>=0?this.scrollUpEdge=-(t+this.blankArea):0>t&&(this.scrollUpEdge=-(this.blankArea-Math.abs(t)>0?this.blankArea-Math.abs(t):0))},toTop:function(t,e){var s=this,n=null;e&&"function"==typeof e&&(n=e);var o=t.parents(".dragmodule[drag-mode!=container]:visible"),a=this.$moduleOnTop,r=this.topOffset.top;if(window.ActiveXObject&&!window.XMLHttpRequest)return void o.insertBefore(a);var d=o.height(),l=o.width(),h=parseInt(o.css("margin-bottom").split("px")[0]),m=o.position();if(s.getOnTop(),m.top!==s.topOffset.top){var u=o.clone().css({position:"absolute",top:m.top+"px",width:l+"px",height:d+"px",zIndex:200,display:"none"}).appendTo(s.$container),c=i("<div></div>");s.$container.css("position","relative"),s.aniTime=s.slideTime*Math.round((m.top-s.topOffset.top)/s.unitHeight),s.aniTime>800&&(s.aniTime=800),"inherit"===o.attr("drag-mode")&&o.attr({"drag-mode":"individual","class":s.ClassRowIndex}),i("."+s.ClassOnTop).removeClass(s.ClassOnTop),o.addClass(s.ClassOnTop),c.css({height:d+h+"px",marginBottom:0,width:l+"px",overflow:"hidden",visibility:"hidden",opacity:0}).insertBefore(o),o.css({height:0,marginBottom:0,opacity:0}).insertBefore(a),s.$moduleOnTop=o,c.animate({height:0},s.slideTime,function(){i(this).remove()}),o.animate({height:d+h+"px",opacity:1},s.slideTime,function(){i(this).css({height:d+"px",marginBottom:h+"px"}),s.init(!0)}),u.css({display:"block",opacity:1}).animate({opacity:.2,top:r+"px"},s.aniTime,function(){i(this).remove(),n&&n()})}},getOnTop:function(){var t=this;this.$itemRows=this.$container.find(".dragmodule[drag-mode!=container]:visible"),this.$itemRows.removeClass(t.ClassOnTop),i(this.$itemRows[0]).addClass(t.ClassOnTop),this.$moduleOnTop=i(this.$itemRows[0]),this.topOffset=this.$moduleOnTop.position()},excuteCallback:function(){this.callback&&this.callback()},showList:function(){this.$vList.show().animate({opacity:1},200)},hideList:function(){this.$vList.fadeOut(200,function(){i(this).remove()})},getUA:function(){var i,t={},e=navigator.userAgent.toLowerCase();return(i=e.match(/rv:([\d.]+)\) like gecko/))?t.ie=i[1]:(i=e.match(/msie ([\d.]+)/))?t.ie=i[1]:(i=e.match(/firefox\/([\d.]+)/))?t.firefox=i[1]:(i=e.match(/chrome\/([\d.]+)/))?t.chrome=i[1]:(i=e.match(/opera.([\d.]+)/))?t.opera=i[1]:(i=e.match(/version\/([\d.]+).*safari/))?t.safari=i[1]:0,t},unBind:function(){this.$banners&&0!=this.$banners.length&&this.$banners.unbind("mousedown mouseup"),this.$dragScar&&0!=this.$dragScar.length&&this.$dragScar.unbind("mousedown mouseup")}};return t}(jQuery||window.jQuery);